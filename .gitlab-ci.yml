######################################################
## Variables used by the test runs
######################################################

variables:
    EXTRA_DOCKER_RUN_ARGS: "--shm-size=1G --ulimit memlock=-1 --ulimit stack=$$((1024*65536))"
    DATADIR: /raid/dldata

    # the following will be overridden by jobs of the pipeline that actually need to check out the sources
    GIT_STRATEGY: none
    GIT_SUBMODULE_STRATEGY: none

######################################################
## Build steps.
##    DO NOT MODIFY THIS SECTION
######################################################

stages:
    - build base
    - build devel
    - trigger
    - test
    - staging

before_script:
    - echo "${CI_BUILD_NAME}" | grep -Eq "(^|-)py2($|-)" && export PYVER=2.7 || export PYVER=3.5   && echo "${PYVER}"
    - export NV_DOCKER_ARGS="curl -s http://localhost:3476/docker/cli?dev=${RUNNER_GPUS//,/+}"     && echo "${NV_DOCKER_ARGS}"
    - export RELEASE_BRANCH_NAME=${CI_COMMIT_REF_NAME%%-devel}                                     && echo "${RELEASE_BRANCH_NAME}"
    - export IMAGE_NAME_ROOT="${CI_REGISTRY_IMAGE}:${RELEASE_BRANCH_NAME}-py${PYVER%.*}"           && echo "${IMAGE_NAME_PREFIX}"
    - export BASE_IMAGE_NAME="${IMAGE_NAME_ROOT}-base"                                             && echo "${BASE_IMAGE_NAME}"
    - export BASE_IMAGE_NAME_VERSIONED="${IMAGE_NAME_ROOT}.${CI_PIPELINE_ID}"                      && echo "${BASE_IMAGE_NAME_VERSIONED}"
    - export DEVEL_IMAGE_NAME="${IMAGE_NAME_ROOT}-devel"                                           && echo "${DEVEL_IMAGE_NAME}"
    - export DEVEL_IMAGE_NAME_VERSIONED="${IMAGE_NAME_ROOT}.${CI_PIPELINE_ID}-devel"               && echo "${DEVEL_IMAGE_NAME_VERSIONED}"
    - export STAGE_IMAGE_NAME="${IMAGE_NAME_ROOT}-stage"                                           && echo "${STAGE_IMAGE_NAME}"
    - export QA_IMAGE_NAME="${IMAGE_NAME_ROOT}-qa"                                                 && echo "${QA_IMAGE_NAME}"
    - export ORIGIN1="${CI_REPOSITORY_URL##*@}"
    - export ORIGIN_SSH=git@${ORIGIN1/\//:}                                                        && echo "${ORIGIN_SSH}"
    - export ORIGIN_HTTPS=https://${ORIGIN1}                                                       && echo "${ORIGIN_HTTPS}"
    - docker login -u gitlab-ci-token -p "${CI_JOB_TOKEN}" "${CI_REGISTRY}"

.base_template : &BASE
    variables:
      GIT_STRATEGY: fetch
      GIT_SUBMODULE_STRATEGY: recursive
      GET_SOURCES_ATTEMPTS: 3
    script:
    - echo -e "Dockerfile*\n"
              ".git*\n"
              ".dockerignore\n"
              "qa" > .dockerignore
    - docker pull "${BASE_IMAGE_NAME}" || true
    - docker build --pull
                   --cache-from "${BASE_IMAGE_NAME}"
                   -t "${BASE_IMAGE_NAME}" -t "${BASE_IMAGE_NAME_VERSIONED}"
                   --build-arg "NVIDIA_BUILD_REF=${CI_COMMIT_SHA}"
                   --build-arg "NVIDIA_BUILD_ID=${CI_JOB_ID}"
                   --build-arg "PYVER=${PYVER}" .
    - docker push "${BASE_IMAGE_NAME}"
    - docker push "${BASE_IMAGE_NAME_VERSIONED}"
    except:
    - tags

py2-base:
    stage: build base
    <<: *BASE

py3-base:
    stage: build base
    <<: *BASE

.devel_template : &DEVEL
    variables:
      GIT_STRATEGY: fetch
      GIT_SUBMODULE_STRATEGY: recursive
      GET_SOURCES_ATTEMPTS: 3
    script:
    - echo -e "FROM ${BASE_IMAGE_NAME_VERSIONED}\n"
              "COPY Dockerfile* /opt/${CI_PROJECT_NAME}/\n"
              "COPY .gitignore /opt/${CI_PROJECT_NAME}/\n"
              "COPY .gitmodules /opt/${CI_PROJECT_NAME}/\n"
              "COPY .gitlab-ci.yml /opt/${CI_PROJECT_NAME}/\n"
              "COPY .git/ /opt/${CI_PROJECT_NAME}/.git/\n"
              "COPY qa/   /opt/${CI_PROJECT_NAME}/qa/\n"
        > Dockerfile.${CI_PROJECT_NAME}.${CI_COMMIT_REF_NAME}
    - git remote set-url origin ${ORIGIN_HTTPS}
    - docker build --pull -t "${DEVEL_IMAGE_NAME}" -t "${DEVEL_IMAGE_NAME_VERSIONED}"
                   -f Dockerfile.${CI_PROJECT_NAME}.${CI_COMMIT_REF_NAME} .
    - docker push "${DEVEL_IMAGE_NAME}"
    - docker push "${DEVEL_IMAGE_NAME_VERSIONED}"
    except:
    - tags

py2-devel:
    stage: build devel
    <<: *DEVEL

py3-devel:
    stage: build devel
    <<: *DEVEL

digits:
    stage: trigger
    variables:
      GIT_STRATEGY: fetch
      GIT_SUBMODULE_STRATEGY: none
      GET_SOURCES_ATTEMPTS: 3
    script:
    - export REPO="${ORIGIN1/${CI_PROJECT_NAME}/${CI_BUILD_NAME}}"
    - export REPO_SSH="${ORIGIN_SSH/${CI_PROJECT_NAME}/${CI_BUILD_NAME}}"
    - mkdir triggers
    - cd triggers
    - git config --global user.name "gitlab-runner"
    - git config --global user.email "gitlab-runner@${REPO%%/*}"
    - git config --global push.default simple
    - git clone ${REPO_SSH} --branch ${CI_BUILD_REF_NAME} ${CI_BUILD_NAME}
    - cd ${CI_BUILD_NAME}
    - git submodule sync
    - git submodule update --init -- ${CI_PROJECT_NAME} || true
    - cd ${CI_PROJECT_NAME}
    - git checkout ${CI_BUILD_REF}
    - cd ..
    - rm -rf triggers
    - git add ${CI_PROJECT_NAME}
    - export FROM1=${ORIGIN1#*/} && export FROM=${FROM1%.git}
    - git commit -m "Trigger update of ${FROM} at ${CI_BUILD_REF:0:8}"
    - git push
    only:
    - /^.*-devel$/
    except:
    - tags

.stage_template : &STAGE
    environment: staging
    variables:
      GIT_STRATEGY: fetch
      GIT_SUBMODULE_STRATEGY: recursive
      GET_SOURCES_ATTEMPTS: 3
    script:
    # push a xx.yy-stage tag that records the commit we staged from
    - git remote set-url origin ${ORIGIN_SSH}
    - git push --delete origin refs/tags/${CI_COMMIT_REF_NAME/%-devel/-stage}
    - git push origin HEAD:refs/tags/${CI_COMMIT_REF_NAME/%-devel/-stage}
    # create xx.yy-stage image
    - docker pull "${BASE_IMAGE_NAME_VERSIONED}"
    - docker tag "${BASE_IMAGE_NAME_VERSIONED}" "${STAGE_IMAGE_NAME}"
    - docker push "${STAGE_IMAGE_NAME}"
    # create xx.yy-qa image on top of -stage that adds the qa/* tests back in
    - echo -e "FROM ${STAGE_IMAGE_NAME}\n"
              "COPY qa/   /opt/${CI_PROJECT_NAME}/qa/\n"
        > Dockerfile.${CI_PROJECT_NAME}.${CI_COMMIT_REF_NAME/%-devel/-qa}
    - docker build --pull -t "${QA_IMAGE_NAME}" -f Dockerfile.${CI_PROJECT_NAME}.${CI_COMMIT_REF_NAME/%-devel/-qa} .
    - docker push "${QA_IMAGE_NAME}"
    only:
    - /^.*-devel$/
    except:
    - tags
    when: manual

py2-stage:
    stage: staging
    <<: *STAGE

py3-stage:
    stage: staging
    <<: *STAGE

.test_template: &TEST_TEMPLATE
    environment: "${CI_JOB_NAME}"
    variables:
      TEST_WORK_DIR: "/opt/${CI_PROJECT_NAME}/qa/${CI_JOB_NAME}/"
      TEST_SCRIPT: "./test.sh"
    script:
    - export RUNNER="${CI_BUILD_NAME##*--}"
    - export TEST_WORK_DIR="${TEST_WORK_DIR%%--*}"
    - export TEST_SCRIPT="${TEST_SCRIPT/--$RUNNER.sh/.sh}"
    - export TEST_SCRIPT="${TEST_SCRIPT/--py[23].sh/.sh}"
    - cat /proc/driver/nvidia/version
    - set -x &&
      docker run --rm $(eval ${NV_DOCKER_ARGS})
             -v $DATADIR:/data
             $(eval echo ${EXTRA_DOCKER_RUN_ARGS})
             ${DEVEL_IMAGE_NAME_VERSIONED}
             /bin/bash -c "nvidia-smi && cd ${TEST_WORK_DIR} && exec bash -ex ${TEST_SCRIPT}"
    tags:
    - must_specify_runner
    except:
    - tags
    allow_failure: false

.manual_test_trigger: &MANUAL_TEST_TRIGGER
    stage: trigger
    script:
    - export SCOPE1=${CI_JOB_NAME%% tests}; export SCOPE=${SCOPE1##Run all }
    - docker pull ${CI_REGISTRY}/devops/scripts:nvdl_nightly_test_scheduler
    - docker run --rm ${CI_REGISTRY}/devops/scripts:nvdl_nightly_test_scheduler ${CI_PIPELINE_ID} ${CI_PROJECT_PATH} ${SCOPE}
    except:
    - tags
    when: manual

.L0_test: &L0_TEST
    stage: test
    <<: *TEST_TEMPLATE

.L1_test: &L1_TEST
    stage: test
    <<: *TEST_TEMPLATE
    when: manual
    allow_failure: true

.L2_test: &L2_TEST
    stage: test
    <<: *TEST_TEMPLATE
    when: manual
    allow_failure: true

.L3_test: &L3_TEST
    stage: test
    <<: *TEST_TEMPLATE
    when: manual
    allow_failure: true

"Run all L1 tests":
    <<: *MANUAL_TEST_TRIGGER

"Run all L2 tests":
    <<: *MANUAL_TEST_TRIGGER

.P100_R384_4GPU: &P100_R384_4GPU
    tags:
    - P100
    - R384
    - 4GPU

.V100_R384_4GPU: &V100_R384_4GPU
    tags:
    - V100
    - R384
    - 4GPU

.1080Ti_R384_1GPU: &1080Ti_R384_1GPU
    tags:
    - 1080Ti
    - R384
    - 1GPU
    only:
    - /^.*-devel$/

.TitanXP_R384_2GPU: &TitanXP_R384_2GPU
    tags:
    - TitanXP
    - R384
    - 2GPU
    only:
    - /^.*-devel$/

.M60_R384_2GPU: &M60_R384_2GPU
    tags:
    - M60
    - R384
    - 2GPU
    only:
    - /^.*-devel$/

.K80_R384_2GPU: &K80_R384_2GPU
    tags:
    - K80
    - R384
    - 2GPU
    only:
    - /^.*-devel$/

.P40_R384_1GPU: &P40_R384_1GPU
    tags:
    - P40
    - R384
    - 1GPU
    only:
    - /^.*-devel$/

.M40_R384_1GPU: &M40_R384_1GPU
    tags:
    - M40
    - R384
    - 1GPU
    only:
    - /^.*-devel$/

######################################################
##
## Test definitions.
##
##   By convention, test names should be prefixed
##   with "L0_" or "L1_" etc.
##
##   Normally qa/ will be a submodule that pulls in
##   all of the stuff needed to run the tests into the
##   *-devel images.
##
##   The CI script templates above expect each test to
##   be defined in /opt/<project>/qa/<testname>/test.sh.
##   This behavior is specified by the variables
##   $TEST_WORK_DIR and $TEST_SCRIPT.  You can override
##   either of those variables for a given test, but if
##   you do, you have to override them both together,
##   like this:
##
##   L0_mytest:
##      <<: *L0_TEST
##      variables:
##        TEST_WORK_DIR: "/some/other/path"
##        TEST_SCRIPT: "./test.sh"
##
######################################################

############################################################
## TEMPLATES
##
.L2_cnn_benchmark: &L2_CNN_BENCHMARK
    <<: *L2_TEST
    variables:
      TEST_WORK_DIR: "/opt/tensorflow/qa/cnn_benchmarks"
      TEST_SCRIPT: "./${CI_BUILD_NAME}.sh"
.L3_cnn_benchmark: &L3_CNN_BENCHMARK
    <<: *L3_TEST
    variables:
      TEST_WORK_DIR: "/opt/tensorflow/qa/cnn_benchmarks"
      TEST_SCRIPT: "./${CI_BUILD_NAME}.sh"
.L0_nvcnn_benchmark: &L0_NVCNN_BENCHMARK
    <<: *L0_TEST
    variables:
      TEST_WORK_DIR: "/opt/tensorflow/qa/nvcnn_benchmarks"
      TEST_SCRIPT: "./${CI_BUILD_NAME}.sh"
.L2_nvcnn_benchmark: &L2_NVCNN_BENCHMARK
    <<: *L2_TEST
    variables:
      TEST_WORK_DIR: "/opt/tensorflow/qa/nvcnn_benchmarks"
      TEST_SCRIPT: "./${CI_BUILD_NAME}.sh"
############################################################

L0_verify_sig:
    <<: *L0_TEST
    tags:
    - 1GPU

#### P100_R384_4GPU ####

L0_models_alexnet--P100_R384_4GPU:
    <<: *L0_TEST
    <<: *P100_R384_4GPU

L0_models_imagenet--P100_R384_4GPU:
    <<: *L0_TEST
    <<: *P100_R384_4GPU

L0_models_mnist--P100_R384_4GPU:
    <<: *L0_TEST
    <<: *P100_R384_4GPU

L0_convnet_benchmarks_alexnet--P100_R384_4GPU:
    <<: *L0_TEST
    <<: *P100_R384_4GPU
    variables:
      TEST_WORK_DIR: "/opt/tensorflow/qa/L0_convnet_benchmarks"
      TEST_SCRIPT: "./test-alexnet.sh"

L0_convnet_benchmarks_googlenet--P100_R384_4GPU:
    <<: *L0_TEST
    <<: *P100_R384_4GPU
    variables:
      TEST_WORK_DIR: "/opt/tensorflow/qa/L0_convnet_benchmarks"
      TEST_SCRIPT: "./test-googlenet.sh"

L0_convnet_benchmarks_overfeat--P100_R384_4GPU:
    <<: *L0_TEST
    <<: *P100_R384_4GPU
    variables:
      TEST_WORK_DIR: "/opt/tensorflow/qa/L0_convnet_benchmarks"
      TEST_SCRIPT: "./test-overfeat.sh"

L0_convnet_benchmarks_vgga--P100_R384_4GPU:
    <<: *L0_TEST
    <<: *P100_R384_4GPU
    variables:
      TEST_WORK_DIR: "/opt/tensorflow/qa/L0_convnet_benchmarks"
      TEST_SCRIPT: "./test-vgga.sh"

L0_nvcnn_resnet50_batch64_real--P100_R384_4GPU:
    <<: *L0_NVCNN_BENCHMARK
    <<: *P100_R384_4GPU

L0_horovod--P100_R384_4GPU:
    <<: *L0_TEST
    <<: *P100_R384_4GPU

L0_seq2seq--P100_R384_4GPU:
    <<: *L0_TEST
    <<: *P100_R384_4GPU

L1_word2vec--P100_R384_4GPU:
    <<: *L1_TEST
    <<: *P100_R384_4GPU

L1_self_test--P100_R384_4GPU:
    <<: *L1_TEST
    <<: *P100_R384_4GPU

L1_self_test_xla--P100_R384_4GPU:
    <<: *L1_TEST
    <<: *P100_R384_4GPU

L1_nccl_test--P100_R384_4GPU:
    <<: *L1_TEST
    <<: *P100_R384_4GPU

L1_seq2seq--P100_R384_4GPU:
    <<: *L1_TEST
    <<: *P100_R384_4GPU

L2_tensorflow_benchmarks--P100_R384_4GPU:
    <<: *L2_TEST
    <<: *P100_R384_4GPU

L2_models_cifar10--P100_R384_4GPU:
    <<: *L2_TEST
    <<: *P100_R384_4GPU

L2_cnn_alexnet_batch128_real--P100_R384_4GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *P100_R384_4GPU

L2_cnn_alexnet_batch128_synth--P100_R384_4GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *P100_R384_4GPU

L2_cnn_inception3_batch32_real--P100_R384_4GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *P100_R384_4GPU

L2_cnn_inception3_batch32_synth--P100_R384_4GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *P100_R384_4GPU

L2_cnn_inception3_batch64_real--P100_R384_4GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *P100_R384_4GPU

L2_cnn_inception3_batch64_synth--P100_R384_4GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *P100_R384_4GPU

L2_cnn_resnet50_batch32_real--P100_R384_4GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *P100_R384_4GPU

L2_cnn_resnet50_batch32_synth--P100_R384_4GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *P100_R384_4GPU

L2_cnn_resnet50_batch64_real--P100_R384_4GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *P100_R384_4GPU

L2_cnn_resnet50_batch64_synth--P100_R384_4GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *P100_R384_4GPU

L2_nvcnn_alexnet_batch128_real--P100_R384_4GPU:
    <<: *L2_NVCNN_BENCHMARK
    <<: *P100_R384_4GPU

L2_nvcnn_resnet50_batch64_real--P100_R384_4GPU:
    <<: *L2_NVCNN_BENCHMARK
    <<: *P100_R384_4GPU

L2_nvcnn_inception3_batch64_real--P100_R384_4GPU:
    <<: *L2_NVCNN_BENCHMARK
    <<: *P100_R384_4GPU

L3_cnn_resnet50_batch64_real_long--P100_R384_4GPU:
    <<: *L3_CNN_BENCHMARK
    <<: *P100_R384_4GPU

#### V100_R384_4GPU Python 3 ####

L0_models_alexnet--V100_R384_4GPU:
    <<: *L0_TEST
    <<: *V100_R384_4GPU

L0_models_imagenet--V100_R384_4GPU:
    <<: *L0_TEST
    <<: *V100_R384_4GPU

L0_models_mnist--V100_R384_4GPU:
    <<: *L0_TEST
    <<: *V100_R384_4GPU

L0_convnet_benchmarks_alexnet--V100_R384_4GPU:
    <<: *L0_TEST
    <<: *V100_R384_4GPU
    variables:
      TEST_WORK_DIR: "/opt/tensorflow/qa/L0_convnet_benchmarks"
      TEST_SCRIPT: "./test-alexnet.sh"

L0_convnet_benchmarks_googlenet--V100_R384_4GPU:
    <<: *L0_TEST
    <<: *V100_R384_4GPU
    variables:
      TEST_WORK_DIR: "/opt/tensorflow/qa/L0_convnet_benchmarks"
      TEST_SCRIPT: "./test-googlenet.sh"

L0_convnet_benchmarks_overfeat--V100_R384_4GPU:
    <<: *L0_TEST
    <<: *V100_R384_4GPU
    variables:
      TEST_WORK_DIR: "/opt/tensorflow/qa/L0_convnet_benchmarks"
      TEST_SCRIPT: "./test-overfeat.sh"

L0_convnet_benchmarks_vgga--V100_R384_4GPU:
    <<: *L0_TEST
    <<: *V100_R384_4GPU
    variables:
      TEST_WORK_DIR: "/opt/tensorflow/qa/L0_convnet_benchmarks"
      TEST_SCRIPT: "./test-vgga.sh"

L0_nvcnn_resnet50_batch64_real--V100_R384_4GPU:
    <<: *L0_NVCNN_BENCHMARK
    <<: *V100_R384_4GPU

L0_horovod--V100_R384_4GPU:
    <<: *L0_TEST
    <<: *V100_R384_4GPU

L0_seq2seq--V100_R384_4GPU:
    <<: *L0_TEST
    <<: *V100_R384_4GPU

L1_word2vec--V100_R384_4GPU:
    <<: *L1_TEST
    <<: *V100_R384_4GPU

L1_self_test--V100_R384_4GPU:
    <<: *L1_TEST
    <<: *V100_R384_4GPU

L1_self_test_xla--V100_R384_4GPU:
    <<: *L1_TEST
    <<: *V100_R384_4GPU

L1_nccl_test--V100_R384_4GPU:
    <<: *L1_TEST
    <<: *V100_R384_4GPU

L1_seq2seq--V100_R384_4GPU:
    <<: *L1_TEST
    <<: *V100_R384_4GPU

L2_tensorflow_benchmarks--V100_R384_4GPU:
    <<: *L2_TEST
    <<: *V100_R384_4GPU

L2_models_cifar10--V100_R384_4GPU:
    <<: *L2_TEST
    <<: *V100_R384_4GPU

L2_cnn_alexnet_batch128_real--V100_R384_4GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *V100_R384_4GPU

L2_cnn_alexnet_batch128_synth--V100_R384_4GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *V100_R384_4GPU

L2_cnn_inception3_batch32_real--V100_R384_4GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *V100_R384_4GPU

L2_cnn_inception3_batch32_synth--V100_R384_4GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *V100_R384_4GPU

L2_cnn_inception3_batch64_real--V100_R384_4GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *V100_R384_4GPU

L2_cnn_inception3_batch64_synth--V100_R384_4GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *V100_R384_4GPU

L2_cnn_resnet50_batch32_real--V100_R384_4GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *V100_R384_4GPU

L2_cnn_resnet50_batch32_synth--V100_R384_4GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *V100_R384_4GPU

L2_cnn_resnet50_batch64_real--V100_R384_4GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *V100_R384_4GPU

L2_cnn_resnet50_batch64_synth--V100_R384_4GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *V100_R384_4GPU

L2_nvcnn_alexnet_batch128_real--V100_R384_4GPU:
    <<: *L2_NVCNN_BENCHMARK
    <<: *V100_R384_4GPU

L2_nvcnn_resnet50_batch64_real--V100_R384_4GPU:
    <<: *L2_NVCNN_BENCHMARK
    <<: *V100_R384_4GPU

L2_nvcnn_inception3_batch64_real--V100_R384_4GPU:
    <<: *L2_NVCNN_BENCHMARK
    <<: *V100_R384_4GPU

L3_cnn_resnet50_batch64_real_long--V100_R384_4GPU:
    <<: *L3_CNN_BENCHMARK
    <<: *V100_R384_4GPU

#### V100_R384_4GPU Python 2 ####

L0_models_alexnet--py2--V100_R384_4GPU:
    <<: *L0_TEST
    <<: *V100_R384_4GPU

L0_models_imagenet--py2--V100_R384_4GPU:
    <<: *L0_TEST
    <<: *V100_R384_4GPU

L0_models_mnist--py2--V100_R384_4GPU:
    <<: *L0_TEST
    <<: *V100_R384_4GPU

L0_convnet_benchmarks_alexnet--py2--V100_R384_4GPU:
    <<: *L0_TEST
    <<: *V100_R384_4GPU
    variables:
      TEST_WORK_DIR: "/opt/tensorflow/qa/L0_convnet_benchmarks"
      TEST_SCRIPT: "./test-alexnet.sh"

L0_convnet_benchmarks_googlenet--py2--V100_R384_4GPU:
    <<: *L0_TEST
    <<: *V100_R384_4GPU
    variables:
      TEST_WORK_DIR: "/opt/tensorflow/qa/L0_convnet_benchmarks"
      TEST_SCRIPT: "./test-googlenet.sh"

L0_convnet_benchmarks_overfeat--py2--V100_R384_4GPU:
    <<: *L0_TEST
    <<: *V100_R384_4GPU
    variables:
      TEST_WORK_DIR: "/opt/tensorflow/qa/L0_convnet_benchmarks"
      TEST_SCRIPT: "./test-overfeat.sh"

L0_convnet_benchmarks_vgga--py2--V100_R384_4GPU:
    <<: *L0_TEST
    <<: *V100_R384_4GPU
    variables:
      TEST_WORK_DIR: "/opt/tensorflow/qa/L0_convnet_benchmarks"
      TEST_SCRIPT: "./test-vgga.sh"

L0_nvcnn_resnet50_batch64_real--py2--V100_R384_4GPU:
    <<: *L0_NVCNN_BENCHMARK
    <<: *V100_R384_4GPU

L0_horovod--py2--V100_R384_4GPU:
    <<: *L0_TEST
    <<: *V100_R384_4GPU

L0_seq2seq--py2--V100_R384_4GPU:
    <<: *L0_TEST
    <<: *V100_R384_4GPU

L1_word2vec--py2--V100_R384_4GPU:
    <<: *L1_TEST
    <<: *V100_R384_4GPU

L1_self_test--py2--V100_R384_4GPU:
    <<: *L1_TEST
    <<: *V100_R384_4GPU

L1_self_test_xla--py2--V100_R384_4GPU:
    <<: *L1_TEST
    <<: *V100_R384_4GPU

L1_nccl_test--py2--V100_R384_4GPU:
    <<: *L1_TEST
    <<: *V100_R384_4GPU

L1_seq2seq--py2--V100_R384_4GPU:
    <<: *L1_TEST
    <<: *V100_R384_4GPU

L2_tensorflow_benchmarks--py2--V100_R384_4GPU:
    <<: *L2_TEST
    <<: *V100_R384_4GPU

L2_models_cifar10--py2--V100_R384_4GPU:
    <<: *L2_TEST
    <<: *V100_R384_4GPU

L2_cnn_alexnet_batch128_real--py2--V100_R384_4GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *V100_R384_4GPU

L2_cnn_alexnet_batch128_synth--py2--V100_R384_4GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *V100_R384_4GPU

L2_cnn_inception3_batch32_real--py2--V100_R384_4GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *V100_R384_4GPU

L2_cnn_inception3_batch32_synth--py2--V100_R384_4GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *V100_R384_4GPU

L2_cnn_inception3_batch64_real--py2--V100_R384_4GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *V100_R384_4GPU

L2_cnn_inception3_batch64_synth--py2--V100_R384_4GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *V100_R384_4GPU

L2_cnn_resnet50_batch32_real--py2--V100_R384_4GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *V100_R384_4GPU

L2_cnn_resnet50_batch32_synth--py2--V100_R384_4GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *V100_R384_4GPU

L2_cnn_resnet50_batch64_real--py2--V100_R384_4GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *V100_R384_4GPU

L2_cnn_resnet50_batch64_synth--py2--V100_R384_4GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *V100_R384_4GPU

L2_nvcnn_alexnet_batch128_real--py2--V100_R384_4GPU:
    <<: *L2_NVCNN_BENCHMARK
    <<: *V100_R384_4GPU

L2_nvcnn_resnet50_batch64_real--py2--V100_R384_4GPU:
    <<: *L2_NVCNN_BENCHMARK
    <<: *V100_R384_4GPU

L2_nvcnn_inception3_batch64_real--py2--V100_R384_4GPU:
    <<: *L2_NVCNN_BENCHMARK
    <<: *V100_R384_4GPU

L3_cnn_resnet50_batch64_real_long--py2--V100_R384_4GPU:
    <<: *L3_CNN_BENCHMARK
    <<: *V100_R384_4GPU

##### 1080Ti_R384_1GPU ####
#
#L0_models_alexnet--1080Ti_R384_1GPU:
#    <<: *L0_TEST
#    <<: *1080Ti_R384_1GPU
#
#L0_models_imagenet--1080Ti_R384_1GPU:
#    <<: *L0_TEST
#    <<: *1080Ti_R384_1GPU
#
#L0_models_mnist--1080Ti_R384_1GPU:
#    <<: *L0_TEST
#    <<: *1080Ti_R384_1GPU
#
#L0_convnet_benchmarks_alexnet--1080Ti_R384_1GPU:
#    <<: *L0_TEST
#    <<: *1080Ti_R384_1GPU
#    variables:
#      TEST_WORK_DIR: "/opt/tensorflow/qa/L0_convnet_benchmarks"
#      TEST_SCRIPT: "./test-alexnet.sh"
#
#L0_convnet_benchmarks_googlenet--1080Ti_R384_1GPU:
#    <<: *L0_TEST
#    <<: *1080Ti_R384_1GPU
#    variables:
#      TEST_WORK_DIR: "/opt/tensorflow/qa/L0_convnet_benchmarks"
#      TEST_SCRIPT: "./test-googlenet.sh"
#
#L0_convnet_benchmarks_overfeat--1080Ti_R384_1GPU:
#    <<: *L0_TEST
#    <<: *1080Ti_R384_1GPU
#    variables:
#      TEST_WORK_DIR: "/opt/tensorflow/qa/L0_convnet_benchmarks"
#      TEST_SCRIPT: "./test-overfeat.sh"
#
#L0_convnet_benchmarks_vgga--1080Ti_R384_1GPU:
#    <<: *L0_TEST
#    <<: *1080Ti_R384_1GPU
#    variables:
#      TEST_WORK_DIR: "/opt/tensorflow/qa/L0_convnet_benchmarks"
#      TEST_SCRIPT: "./test-vgga.sh"
#
#L1_word2vec--1080Ti_R384_1GPU:
#    <<: *L1_TEST
#    <<: *1080Ti_R384_1GPU
#
#L1_self_test--1080Ti_R384_1GPU:
#    <<: *L1_TEST
#    <<: *1080Ti_R384_1GPU
#
#L1_self_test_xla--1080Ti_R384_1GPU:
#    <<: *L1_TEST
#    <<: *1080Ti_R384_1GPU
#
#L1_nccl_test--1080Ti_R384_1GPU:
#    <<: *L1_TEST
#    <<: *1080Ti_R384_1GPU
#
#L2_tensorflow_benchmarks--1080Ti_R384_1GPU:
#    <<: *L2_TEST
#    <<: *1080Ti_R384_1GPU
#
#L2_models_cifar10--1080Ti_R384_1GPU:
#    <<: *L2_TEST
#    <<: *1080Ti_R384_1GPU
#
#L2_cnn_alexnet_batch128_real--1080Ti_R384_1GPU:
#    <<: *L2_CNN_BENCHMARK
#    <<: *1080Ti_R384_1GPU
#
#L2_cnn_alexnet_batch128_synth--1080Ti_R384_1GPU:
#    <<: *L2_CNN_BENCHMARK
#    <<: *1080Ti_R384_1GPU
#
#L2_cnn_inception3_batch32_real--1080Ti_R384_1GPU:
#    <<: *L2_CNN_BENCHMARK
#    <<: *1080Ti_R384_1GPU
#
#L2_cnn_inception3_batch32_synth--1080Ti_R384_1GPU:
#    <<: *L2_CNN_BENCHMARK
#    <<: *1080Ti_R384_1GPU
#
#L2_cnn_inception3_batch64_real--1080Ti_R384_1GPU:
#    <<: *L2_CNN_BENCHMARK
#    <<: *1080Ti_R384_1GPU
#
#L2_cnn_inception3_batch64_synth--1080Ti_R384_1GPU:
#    <<: *L2_CNN_BENCHMARK
#    <<: *1080Ti_R384_1GPU
#
#L2_cnn_resnet50_batch32_real--1080Ti_R384_1GPU:
#    <<: *L2_CNN_BENCHMARK
#    <<: *1080Ti_R384_1GPU
#
#L2_cnn_resnet50_batch32_synth--1080Ti_R384_1GPU:
#    <<: *L2_CNN_BENCHMARK
#    <<: *1080Ti_R384_1GPU
#
#L2_cnn_resnet50_batch64_real--1080Ti_R384_1GPU:
#    <<: *L2_CNN_BENCHMARK
#    <<: *1080Ti_R384_1GPU
#
#L2_cnn_resnet50_batch64_synth--1080Ti_R384_1GPU:
#    <<: *L2_CNN_BENCHMARK
#    <<: *1080Ti_R384_1GPU
#
#L2_nvcnn_alexnet_batch128_real--1080Ti_R384_1GPU:
#    <<: *L2_NVCNN_BENCHMARK
#    <<: *1080Ti_R384_1GPU
#
#L2_nvcnn_resnet50_batch64_real--1080Ti_R384_1GPU:
#    <<: *L2_NVCNN_BENCHMARK
#    <<: *1080Ti_R384_1GPU
#
#L2_nvcnn_inception3_batch64_real--1080Ti_R384_1GPU:
#    <<: *L2_NVCNN_BENCHMARK
#    <<: *1080Ti_R384_1GPU
#
#L3_cnn_resnet50_batch64_real_long--1080Ti_R384_1GPU:
#    <<: *L3_CNN_BENCHMARK
#    <<: *1080Ti_R384_1GPU
#
##### TitanXP_R384_2GPU ####
#
#L0_models_alexnet--TitanXP_R384_2GPU:
#    <<: *L0_TEST
#    <<: *TitanXP_R384_2GPU
#
#L0_models_imagenet--TitanXP_R384_2GPU:
#    <<: *L0_TEST
#    <<: *TitanXP_R384_2GPU
#
#L0_models_mnist--TitanXP_R384_2GPU:
#    <<: *L0_TEST
#    <<: *TitanXP_R384_2GPU
#
#L0_convnet_benchmarks_alexnet--TitanXP_R384_2GPU:
#    <<: *L0_TEST
#    <<: *TitanXP_R384_2GPU
#    variables:
#      TEST_WORK_DIR: "/opt/tensorflow/qa/L0_convnet_benchmarks"
#      TEST_SCRIPT: "./test-alexnet.sh"
#
#L0_convnet_benchmarks_googlenet--TitanXP_R384_2GPU:
#    <<: *L0_TEST
#    <<: *TitanXP_R384_2GPU
#    variables:
#      TEST_WORK_DIR: "/opt/tensorflow/qa/L0_convnet_benchmarks"
#      TEST_SCRIPT: "./test-googlenet.sh"
#
#L0_convnet_benchmarks_overfeat--TitanXP_R384_2GPU:
#    <<: *L0_TEST
#    <<: *TitanXP_R384_2GPU
#    variables:
#      TEST_WORK_DIR: "/opt/tensorflow/qa/L0_convnet_benchmarks"
#      TEST_SCRIPT: "./test-overfeat.sh"
#
#L0_convnet_benchmarks_vgga--TitanXP_R384_2GPU:
#    <<: *L0_TEST
#    <<: *TitanXP_R384_2GPU
#    variables:
#      TEST_WORK_DIR: "/opt/tensorflow/qa/L0_convnet_benchmarks"
#      TEST_SCRIPT: "./test-vgga.sh"
#
#L1_word2vec--TitanXP_R384_2GPU:
#    <<: *L1_TEST
#    <<: *TitanXP_R384_2GPU
#
#L1_self_test--TitanXP_R384_2GPU:
#    <<: *L1_TEST
#    <<: *TitanXP_R384_2GPU
#
#L1_self_test_xla--TitanXP_R384_2GPU:
#    <<: *L1_TEST
#    <<: *TitanXP_R384_2GPU
#
#L1_nccl_test--TitanXP_R384_2GPU:
#    <<: *L1_TEST
#    <<: *TitanXP_R384_2GPU
#
#L2_tensorflow_benchmarks--TitanXP_R384_2GPU:
#    <<: *L2_TEST
#    <<: *TitanXP_R384_2GPU
#
#L2_models_cifar10--TitanXP_R384_2GPU:
#    <<: *L2_TEST
#    <<: *TitanXP_R384_2GPU
#
#L2_cnn_alexnet_batch128_real--TitanXP_R384_2GPU:
#    <<: *L2_CNN_BENCHMARK
#    <<: *TitanXP_R384_2GPU
#
#L2_cnn_alexnet_batch128_synth--TitanXP_R384_2GPU:
#    <<: *L2_CNN_BENCHMARK
#    <<: *TitanXP_R384_2GPU
#
#L2_cnn_inception3_batch32_real--TitanXP_R384_2GPU:
#    <<: *L2_CNN_BENCHMARK
#    <<: *TitanXP_R384_2GPU
#
#L2_cnn_inception3_batch32_synth--TitanXP_R384_2GPU:
#    <<: *L2_CNN_BENCHMARK
#    <<: *TitanXP_R384_2GPU
#
#L2_cnn_inception3_batch64_real--TitanXP_R384_2GPU:
#    <<: *L2_CNN_BENCHMARK
#    <<: *TitanXP_R384_2GPU
#
#L2_cnn_inception3_batch64_synth--TitanXP_R384_2GPU:
#    <<: *L2_CNN_BENCHMARK
#    <<: *TitanXP_R384_2GPU
#
#L2_cnn_resnet50_batch32_real--TitanXP_R384_2GPU:
#    <<: *L2_CNN_BENCHMARK
#    <<: *TitanXP_R384_2GPU
#
#L2_cnn_resnet50_batch32_synth--TitanXP_R384_2GPU:
#    <<: *L2_CNN_BENCHMARK
#    <<: *TitanXP_R384_2GPU
#
#L2_cnn_resnet50_batch64_real--TitanXP_R384_2GPU:
#    <<: *L2_CNN_BENCHMARK
#    <<: *TitanXP_R384_2GPU
#
#L2_cnn_resnet50_batch64_synth--TitanXP_R384_2GPU:
#    <<: *L2_CNN_BENCHMARK
#    <<: *TitanXP_R384_2GPU
#
#L2_nvcnn_alexnet_batch128_real--TitanXP_R384_2GPU:
#    <<: *L2_NVCNN_BENCHMARK
#    <<: *TitanXP_R384_2GPU
#
#L2_nvcnn_resnet50_batch64_real--TitanXP_R384_2GPU:
#    <<: *L2_NVCNN_BENCHMARK
#    <<: *TitanXP_R384_2GPU
#
#L2_nvcnn_inception3_batch64_real--TitanXP_R384_2GPU:
#    <<: *L2_NVCNN_BENCHMARK
#    <<: *TitanXP_R384_2GPU
#
#L3_cnn_resnet50_batch64_real_long--TitanXP_R384_2GPU:
#    <<: *L3_CNN_BENCHMARK
#    <<: *TitanXP_R384_2GPU
#
# #### M60_R384_2GPU ####
# 
# L0_models_alexnet--M60_R384_2GPU:
#     <<: *L0_TEST
#     <<: *M60_R384_2GPU
# 
# L0_models_imagenet--M60_R384_2GPU:
#     <<: *L0_TEST
#     <<: *M60_R384_2GPU
# 
# L0_models_mnist--M60_R384_2GPU:
#     <<: *L0_TEST
#     <<: *M60_R384_2GPU
# 
# L0_convnet_benchmarks_alexnet--M60_R384_2GPU:
#     <<: *L0_TEST
#     <<: *M60_R384_2GPU
#     variables:
#       TEST_WORK_DIR: "/opt/tensorflow/qa/L0_convnet_benchmarks"
#       TEST_SCRIPT: "./test-alexnet.sh"
# 
# L0_convnet_benchmarks_googlenet--M60_R384_2GPU:
#     <<: *L0_TEST
#     <<: *M60_R384_2GPU
#     variables:
#       TEST_WORK_DIR: "/opt/tensorflow/qa/L0_convnet_benchmarks"
#       TEST_SCRIPT: "./test-googlenet.sh"
# 
# L0_convnet_benchmarks_overfeat--M60_R384_2GPU:
#     <<: *L0_TEST
#     <<: *M60_R384_2GPU
#     variables:
#       TEST_WORK_DIR: "/opt/tensorflow/qa/L0_convnet_benchmarks"
#       TEST_SCRIPT: "./test-overfeat.sh"
# 
# L0_convnet_benchmarks_vgga--M60_R384_2GPU:
#     <<: *L0_TEST
#     <<: *M60_R384_2GPU
#     variables:
#       TEST_WORK_DIR: "/opt/tensorflow/qa/L0_convnet_benchmarks"
#       TEST_SCRIPT: "./test-vgga.sh"
# 
# L1_word2vec--M60_R384_2GPU:
#     <<: *L1_TEST
#     <<: *M60_R384_2GPU
# 
# L1_self_test--M60_R384_2GPU:
#     <<: *L1_TEST
#     <<: *M60_R384_2GPU
# 
# L1_self_test_xla--M60_R384_2GPU:
#     <<: *L1_TEST
#     <<: *M60_R384_2GPU
# 
# L1_nccl_test--M60_R384_2GPU:
#     <<: *L1_TEST
#     <<: *M60_R384_2GPU
# 
# L2_tensorflow_benchmarks--M60_R384_2GPU:
#     <<: *L2_TEST
#     <<: *M60_R384_2GPU
# 
# L2_models_cifar10--M60_R384_2GPU:
#     <<: *L2_TEST
#     <<: *M60_R384_2GPU
# 
# L2_cnn_alexnet_batch128_real--M60_R384_2GPU:
#     <<: *L2_CNN_BENCHMARK
#     <<: *M60_R384_2GPU
# 
# L2_cnn_alexnet_batch128_synth--M60_R384_2GPU:
#     <<: *L2_CNN_BENCHMARK
#     <<: *M60_R384_2GPU
# 
# L2_cnn_inception3_batch32_real--M60_R384_2GPU:
#     <<: *L2_CNN_BENCHMARK
#     <<: *M60_R384_2GPU
# 
# L2_cnn_inception3_batch32_synth--M60_R384_2GPU:
#     <<: *L2_CNN_BENCHMARK
#     <<: *M60_R384_2GPU
# 
# L2_cnn_inception3_batch64_real--M60_R384_2GPU:
#     <<: *L2_CNN_BENCHMARK
#     <<: *M60_R384_2GPU
# 
# L2_cnn_inception3_batch64_synth--M60_R384_2GPU:
#     <<: *L2_CNN_BENCHMARK
#     <<: *M60_R384_2GPU
# 
# L2_cnn_resnet50_batch32_real--M60_R384_2GPU:
#     <<: *L2_CNN_BENCHMARK
#     <<: *M60_R384_2GPU
# 
# L2_cnn_resnet50_batch32_synth--M60_R384_2GPU:
#     <<: *L2_CNN_BENCHMARK
#     <<: *M60_R384_2GPU
# 
# L2_cnn_resnet50_batch64_real--M60_R384_2GPU:
#     <<: *L2_CNN_BENCHMARK
#     <<: *M60_R384_2GPU
# 
# L2_cnn_resnet50_batch64_synth--M60_R384_2GPU:
#     <<: *L2_CNN_BENCHMARK
#     <<: *M60_R384_2GPU
# 
# L2_nvcnn_alexnet_batch128_real--M60_R384_2GPU:
#     <<: *L2_NVCNN_BENCHMARK
#     <<: *M60_R384_2GPU
# 
# L2_nvcnn_resnet50_batch64_real--M60_R384_2GPU:
#     <<: *L2_NVCNN_BENCHMARK
#     <<: *M60_R384_2GPU
# 
# L2_nvcnn_inception3_batch64_real--M60_R384_2GPU:
#     <<: *L2_NVCNN_BENCHMARK
#     <<: *M60_R384_2GPU
# 
# L3_cnn_resnet50_batch64_real_long--M60_R384_2GPU:
#     <<: *L3_CNN_BENCHMARK
#     <<: *M60_R384_2GPU

# #### K80_R384_2GPU ####
# 
# L0_models_alexnet--K80_R384_2GPU:
#     <<: *L0_TEST
#     <<: *K80_R384_2GPU
# 
# L0_models_imagenet--K80_R384_2GPU:
#     <<: *L0_TEST
#     <<: *K80_R384_2GPU
# 
# L0_models_mnist--K80_R384_2GPU:
#     <<: *L0_TEST
#     <<: *K80_R384_2GPU
# 
# L0_convnet_benchmarks_alexnet--K80_R384_2GPU:
#     <<: *L0_TEST
#     <<: *K80_R384_2GPU
#     variables:
#       TEST_WORK_DIR: "/opt/tensorflow/qa/L0_convnet_benchmarks"
#       TEST_SCRIPT: "./test-alexnet.sh"
# 
# L0_convnet_benchmarks_googlenet--K80_R384_2GPU:
#     <<: *L0_TEST
#     <<: *K80_R384_2GPU
#     variables:
#       TEST_WORK_DIR: "/opt/tensorflow/qa/L0_convnet_benchmarks"
#       TEST_SCRIPT: "./test-googlenet.sh"
# 
# L0_convnet_benchmarks_overfeat--K80_R384_2GPU:
#     <<: *L0_TEST
#     <<: *K80_R384_2GPU
#     variables:
#       TEST_WORK_DIR: "/opt/tensorflow/qa/L0_convnet_benchmarks"
#       TEST_SCRIPT: "./test-overfeat.sh"
# 
# L0_convnet_benchmarks_vgga--K80_R384_2GPU:
#     <<: *L0_TEST
#     <<: *K80_R384_2GPU
#     variables:
#       TEST_WORK_DIR: "/opt/tensorflow/qa/L0_convnet_benchmarks"
#       TEST_SCRIPT: "./test-vgga.sh"
# 
# L1_word2vec--K80_R384_2GPU:
#     <<: *L1_TEST
#     <<: *K80_R384_2GPU
# 
# L1_self_test--K80_R384_2GPU:
#     <<: *L1_TEST
#     <<: *K80_R384_2GPU
# 
# L1_self_test_xla--K80_R384_2GPU:
#     <<: *L1_TEST
#     <<: *K80_R384_2GPU
# 
# L1_nccl_test--K80_R384_2GPU:
#     <<: *L1_TEST
#     <<: *K80_R384_2GPU
# 
# L2_tensorflow_benchmarks--K80_R384_2GPU:
#     <<: *L2_TEST
#     <<: *K80_R384_2GPU
# 
# L2_models_cifar10--K80_R384_2GPU:
#     <<: *L2_TEST
#     <<: *K80_R384_2GPU
# 
# L2_cnn_alexnet_batch128_real--K80_R384_2GPU:
#     <<: *L2_CNN_BENCHMARK
#     <<: *K80_R384_2GPU
# 
# L2_cnn_alexnet_batch128_synth--K80_R384_2GPU:
#     <<: *L2_CNN_BENCHMARK
#     <<: *K80_R384_2GPU
# 
# L2_cnn_inception3_batch32_real--K80_R384_2GPU:
#     <<: *L2_CNN_BENCHMARK
#     <<: *K80_R384_2GPU
# 
# L2_cnn_inception3_batch32_synth--K80_R384_2GPU:
#     <<: *L2_CNN_BENCHMARK
#     <<: *K80_R384_2GPU
# 
# L2_cnn_inception3_batch64_real--K80_R384_2GPU:
#     <<: *L2_CNN_BENCHMARK
#     <<: *K80_R384_2GPU
# 
# L2_cnn_inception3_batch64_synth--K80_R384_2GPU:
#     <<: *L2_CNN_BENCHMARK
#     <<: *K80_R384_2GPU
# 
# L2_cnn_resnet50_batch32_real--K80_R384_2GPU:
#     <<: *L2_CNN_BENCHMARK
#     <<: *K80_R384_2GPU
# 
# L2_cnn_resnet50_batch32_synth--K80_R384_2GPU:
#     <<: *L2_CNN_BENCHMARK
#     <<: *K80_R384_2GPU
# 
# L2_cnn_resnet50_batch64_real--K80_R384_2GPU:
#     <<: *L2_CNN_BENCHMARK
#     <<: *K80_R384_2GPU
# 
# L2_cnn_resnet50_batch64_synth--K80_R384_2GPU:
#     <<: *L2_CNN_BENCHMARK
#     <<: *K80_R384_2GPU
# 
# L2_nvcnn_alexnet_batch128_real--K80_R384_2GPU:
#     <<: *L2_NVCNN_BENCHMARK
#     <<: *K80_R384_2GPU
# 
# L2_nvcnn_resnet50_batch64_real--K80_R384_2GPU:
#     <<: *L2_NVCNN_BENCHMARK
#     <<: *K80_R384_2GPU
# 
# L2_nvcnn_inception3_batch64_real--K80_R384_2GPU:
#     <<: *L2_NVCNN_BENCHMARK
#     <<: *K80_R384_2GPU
# 
# L3_cnn_resnet50_batch64_real_long--K80_R384_2GPU:
#     <<: *L3_CNN_BENCHMARK
#     <<: *K80_R384_2GPU

#### P40_R384_1GPU ####

L0_models_alexnet--P40_R384_1GPU:
    <<: *L0_TEST
    <<: *P40_R384_1GPU

L0_models_imagenet--P40_R384_1GPU:
    <<: *L0_TEST
    <<: *P40_R384_1GPU

L0_models_mnist--P40_R384_1GPU:
    <<: *L0_TEST
    <<: *P40_R384_1GPU

L0_convnet_benchmarks_alexnet--P40_R384_1GPU:
    <<: *L0_TEST
    <<: *P40_R384_1GPU
    variables:
      TEST_WORK_DIR: "/opt/tensorflow/qa/L0_convnet_benchmarks"
      TEST_SCRIPT: "./test-alexnet.sh"

L0_convnet_benchmarks_googlenet--P40_R384_1GPU:
    <<: *L0_TEST
    <<: *P40_R384_1GPU
    variables:
      TEST_WORK_DIR: "/opt/tensorflow/qa/L0_convnet_benchmarks"
      TEST_SCRIPT: "./test-googlenet.sh"

L0_convnet_benchmarks_overfeat--P40_R384_1GPU:
    <<: *L0_TEST
    <<: *P40_R384_1GPU
    variables:
      TEST_WORK_DIR: "/opt/tensorflow/qa/L0_convnet_benchmarks"
      TEST_SCRIPT: "./test-overfeat.sh"

L0_convnet_benchmarks_vgga--P40_R384_1GPU:
    <<: *L0_TEST
    <<: *P40_R384_1GPU
    variables:
      TEST_WORK_DIR: "/opt/tensorflow/qa/L0_convnet_benchmarks"
      TEST_SCRIPT: "./test-vgga.sh"

L0_horovod--P40_R384_1GPU:
    <<: *L0_TEST
    <<: *P40_R384_1GPU

L0_seq2seq--P40_R384_1GPU:
    <<: *L0_TEST
    <<: *P40_R384_1GPU

L1_word2vec--P40_R384_1GPU:
    <<: *L1_TEST
    <<: *P40_R384_1GPU

L1_self_test--P40_R384_1GPU:
    <<: *L1_TEST
    <<: *P40_R384_1GPU

L1_self_test_xla--P40_R384_1GPU:
    <<: *L1_TEST
    <<: *P40_R384_1GPU

# NCCL test with 1 GPU does not make much sense
# L1_nccl_test--P40_R384_1GPU:
#     <<: *L1_TEST
#     <<: *P40_R384_1GPU

L2_tensorflow_benchmarks--P40_R384_1GPU:
    <<: *L2_TEST
    <<: *P40_R384_1GPU

L2_models_cifar10--P40_R384_1GPU:
    <<: *L2_TEST
    <<: *P40_R384_1GPU

L2_cnn_alexnet_batch128_real--P40_R384_1GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *P40_R384_1GPU

L2_cnn_alexnet_batch128_synth--P40_R384_1GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *P40_R384_1GPU

L2_cnn_inception3_batch32_real--P40_R384_1GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *P40_R384_1GPU

L2_cnn_inception3_batch32_synth--P40_R384_1GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *P40_R384_1GPU

L2_cnn_inception3_batch64_real--P40_R384_1GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *P40_R384_1GPU

L2_cnn_inception3_batch64_synth--P40_R384_1GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *P40_R384_1GPU

L2_cnn_resnet50_batch32_real--P40_R384_1GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *P40_R384_1GPU

L2_cnn_resnet50_batch32_synth--P40_R384_1GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *P40_R384_1GPU

L2_cnn_resnet50_batch64_real--P40_R384_1GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *P40_R384_1GPU

L2_cnn_resnet50_batch64_synth--P40_R384_1GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *P40_R384_1GPU

L2_nvcnn_alexnet_batch128_real--P40_R384_1GPU:
    <<: *L2_NVCNN_BENCHMARK
    <<: *P40_R384_1GPU

L2_nvcnn_resnet50_batch64_real--P40_R384_1GPU:
    <<: *L2_NVCNN_BENCHMARK
    <<: *P40_R384_1GPU

L2_nvcnn_inception3_batch64_real--P40_R384_1GPU:
    <<: *L2_NVCNN_BENCHMARK
    <<: *P40_R384_1GPU

L3_cnn_resnet50_batch64_real_long--P40_R384_1GPU:
    <<: *L3_CNN_BENCHMARK
    <<: *P40_R384_1GPU

#### M40_R384_1GPU ####

L0_models_alexnet--M40_R384_1GPU:
    <<: *L0_TEST
    <<: *M40_R384_1GPU

L0_models_imagenet--M40_R384_1GPU:
    <<: *L0_TEST
    <<: *M40_R384_1GPU

L0_models_mnist--M40_R384_1GPU:
    <<: *L0_TEST
    <<: *M40_R384_1GPU

L0_convnet_benchmarks_alexnet--M40_R384_1GPU:
    <<: *L0_TEST
    <<: *M40_R384_1GPU
    variables:
      TEST_WORK_DIR: "/opt/tensorflow/qa/L0_convnet_benchmarks"
      TEST_SCRIPT: "./test-alexnet.sh"

L0_convnet_benchmarks_googlenet--M40_R384_1GPU:
    <<: *L0_TEST
    <<: *M40_R384_1GPU
    variables:
      TEST_WORK_DIR: "/opt/tensorflow/qa/L0_convnet_benchmarks"
      TEST_SCRIPT: "./test-googlenet.sh"

L0_convnet_benchmarks_overfeat--M40_R384_1GPU:
    <<: *L0_TEST
    <<: *M40_R384_1GPU
    variables:
      TEST_WORK_DIR: "/opt/tensorflow/qa/L0_convnet_benchmarks"
      TEST_SCRIPT: "./test-overfeat.sh"

L0_convnet_benchmarks_vgga--M40_R384_1GPU:
    <<: *L0_TEST
    <<: *M40_R384_1GPU
    variables:
      TEST_WORK_DIR: "/opt/tensorflow/qa/L0_convnet_benchmarks"
      TEST_SCRIPT: "./test-vgga.sh"

L0_horovod--M40_R384_1GPU:
    <<: *L0_TEST
    <<: *M40_R384_1GPU


L1_word2vec--M40_R384_1GPU:
    <<: *L1_TEST
    <<: *M40_R384_1GPU

L1_self_test--M40_R384_1GPU:
    <<: *L1_TEST
    <<: *M40_R384_1GPU

L1_self_test_xla--M40_R384_1GPU:
    <<: *L1_TEST
    <<: *M40_R384_1GPU

# NCCL test with 1 GPU does not make much sense
# L1_nccl_test--M40_R384_1GPU:
#     <<: *L1_TEST
#     <<: *M40_R384_1GPU

L2_tensorflow_benchmarks--M40_R384_1GPU:
    <<: *L2_TEST
    <<: *M40_R384_1GPU

L2_models_cifar10--M40_R384_1GPU:
    <<: *L2_TEST
    <<: *M40_R384_1GPU

L2_cnn_alexnet_batch128_real--M40_R384_1GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *M40_R384_1GPU

L2_cnn_alexnet_batch128_synth--M40_R384_1GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *M40_R384_1GPU

L2_cnn_inception3_batch32_real--M40_R384_1GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *M40_R384_1GPU

L2_cnn_inception3_batch32_synth--M40_R384_1GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *M40_R384_1GPU

L2_cnn_inception3_batch64_real--M40_R384_1GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *M40_R384_1GPU

L2_cnn_inception3_batch64_synth--M40_R384_1GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *M40_R384_1GPU

L2_cnn_resnet50_batch32_real--M40_R384_1GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *M40_R384_1GPU

L2_cnn_resnet50_batch32_synth--M40_R384_1GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *M40_R384_1GPU

L2_cnn_resnet50_batch64_real--M40_R384_1GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *M40_R384_1GPU

L2_cnn_resnet50_batch64_synth--M40_R384_1GPU:
    <<: *L2_CNN_BENCHMARK
    <<: *M40_R384_1GPU

L2_nvcnn_alexnet_batch128_real--M40_R384_1GPU:
    <<: *L2_NVCNN_BENCHMARK
    <<: *M40_R384_1GPU

L2_nvcnn_resnet50_batch64_real--M40_R384_1GPU:
    <<: *L2_NVCNN_BENCHMARK
    <<: *M40_R384_1GPU

L2_nvcnn_inception3_batch64_real--M40_R384_1GPU:
    <<: *L2_NVCNN_BENCHMARK
    <<: *M40_R384_1GPU

L3_cnn_resnet50_batch64_real_long--M40_R384_1GPU:
    <<: *L3_CNN_BENCHMARK
    <<: *M40_R384_1GPU


